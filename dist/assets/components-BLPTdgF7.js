import{j as e,r as t,S as r,L as a,B as s,R as o}from"./react-vendor-bLzc_oLC.js";import{r as n}from"./utils-CamzHhaU.js";const i=({className:t})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"17 8 12 3 7 8"}),e.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),l=({className:t})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M6.13 1L6 16a2 2 0 0 0 2 2h15"}),e.jsx("path",{d:"M1 6.13L16 6a2 2 0 0 1 2 2v15"})]}),d=({className:t})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("polyline",{points:"6 9 6 2 18 2 18 9"}),e.jsx("path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"}),e.jsx("rect",{x:"6",y:"14",width:"12",height:"8"})]}),c=({className:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:e.jsx("path",{d:"m15 18-6-6 6-6"})}),h=({className:t})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),m=({className:t})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M15 4V2"}),e.jsx("path",{d:"M15 10V8"}),e.jsx("path",{d:"M12.5 6.5L10.5 4.5"}),e.jsx("path",{d:"M17.5 6.5L19.5 4.5"}),e.jsx("path",{d:"m9 12-6 6"}),e.jsx("path",{d:"M14.5 9.5 19 5"}),e.jsx("path",{d:"m17 17 5 5"}),e.jsx("path",{d:"M2 22l5-5"})]}),x=({className:t})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("circle",{cx:"12",cy:"12",r:"4"}),e.jsx("path",{d:"M12 2v2"}),e.jsx("path",{d:"M12 20v2"}),e.jsx("path",{d:"m4.93 4.93 1.41 1.41"}),e.jsx("path",{d:"m17.66 17.66 1.41 1.41"}),e.jsx("path",{d:"M2 12h2"}),e.jsx("path",{d:"M20 12h2"}),e.jsx("path",{d:"m4.93 19.07 1.41-1.41"}),e.jsx("path",{d:"m17.66 6.34 1.41-1.41"})]}),g=({className:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:e.jsx("path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"})}),u=({className:t})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M21 2v6h-6"}),e.jsx("path",{d:"M3 12a9 9 0 0 1 15-6.7L21 8"})]}),p=({className:t})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"}),e.jsx("circle",{cx:"12",cy:"13",r:"3"})]}),b=({className:t})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),v=({className:t})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M18 6 6 18"}),e.jsx("path",{d:"M6 6l12 12"})]}),f=({className:t})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("rect",{x:"7",y:"2",width:"10",height:"20",rx:"2",ry:"2"}),e.jsx("line",{x1:"12",y1:"18",x2:"12",y2:"18"})]}),w=({className:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:e.jsx("path",{d:"M20 6 9 17l-5-5"})}),j=({className:t})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"}),e.jsx("path",{d:"M21 3v6h-6"})]}),y=({className:t})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M1 1l22 22"}),e.jsx("path",{d:"M16.72 11.06A10.94 10.94 0 0 1 19 12.55"}),e.jsx("path",{d:"M5 12.55a10.94 10.94 0 0 1 5.17-2.39"}),e.jsx("path",{d:"M10.71 5.05A22 22 0 0 1 12 5c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"})]}),N=({className:t})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M5 12.55a11 11 0 0 1 14.08 0"}),e.jsx("path",{d:"M1.42 9a16 16 0 0 1 21.16 0"}),e.jsx("path",{d:"M8.53 16.11a6 6 0 0 1 6.95 0"}),e.jsx("line",{x1:"12",y1:"20",x2:"12.01",y2:"20"})]}),k=({className:t})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}),e.jsx("path",{d:"M21 3v5h-5"}),e.jsx("path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}),e.jsx("path",{d:"M3 21v-5h5"})]}),S=({className:t})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[e.jsx("path",{d:"M4 6h16"}),e.jsx("path",{d:"M4 12h16"}),e.jsx("path",{d:"M4 18h16"})]}),C=({onImagesUpload:r})=>{const[a,s]=t.useState(!1),[o,n]=t.useState(null),l=t.useCallback(e=>{const t=[];for(let r=0;r<e.length;r++){const a=e[r];a&&a.type.startsWith("image/")&&t.push(a)}if(0===t.length)return void n("No valid image files selected (PNG, JPG, etc.).");n(null);const a=t.map(e=>new Promise((t,r)=>{const a=new FileReader;a.onload=a=>{"string"==typeof a.target?.result?t(a.target.result):r(new Error(`Failed to read file ${e.name}`))},a.onerror=e=>r(e),a.readAsDataURL(e)}));Promise.all(a).then(e=>r(e)).catch(e=>{n("There was an error reading one or more files.")})},[r]);return e.jsx("div",{className:"min-h-[calc(100vh-7rem)] flex items-center justify-center p-3 sm:p-4 md:p-6 safe-bottom",style:{paddingBottom:"env(safe-area-inset-bottom)"},children:e.jsx("div",{className:"w-full max-w-2xl animate-fade-in",children:e.jsx("div",{className:"bg-[var(--card-bg)] backdrop-blur-sm border border-[var(--card-border)] rounded-2xl shadow-lg shadow-[var(--shadow-color)] p-4 sm:p-6 md:p-8",children:e.jsx("div",{className:"flex flex-col gap-6 sm:gap-8",children:e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold mb-2 bg-gradient-to-r from-[var(--accent-primary)] to-[var(--accent-secondary)] bg-clip-text text-transparent leading-tight",children:"Upload Your Photos"}),e.jsx("p",{className:"text-[var(--text-secondary)] text-base sm:text-base",children:"Transform your images into perfect prints"})]}),e.jsxs("div",{className:"relative flex flex-col items-center justify-center p-8 sm:p-10 border-2 border-dashed rounded-2xl transition-all duration-500 "+(a?"border-[var(--accent-primary)] bg-[var(--accent-primary)]/10 scale-[1.02] shadow-lg shadow-[var(--accent-primary)]/20":"border-[var(--control-border)] bg-[var(--control-bg)]/40 hover:border-[var(--accent-primary)]/40 hover:bg-[var(--control-bg)]/60"),onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),s(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),s(!1)},onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:e=>{e.preventDefault(),e.stopPropagation(),s(!1),e.dataTransfer.files&&e.dataTransfer.files.length>0&&(l(e.dataTransfer.files),e.dataTransfer.clearData())},children:[e.jsxs("div",{className:"flex flex-col items-center justify-center text-center space-y-4",children:[e.jsx("div",{className:"transition-all duration-500 "+(a?"scale-110 rotate-12":"scale-100 rotate-0"),children:e.jsx(i,{className:"w-12 h-12 sm:w-16 sm:h-16 text-[var(--accent-primary)] opacity-80"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-[var(--text-primary)] text-base font-medium mb-1",children:[e.jsx("label",{htmlFor:"file-upload",className:"font-bold text-[var(--accent-primary)] cursor-pointer hover:text-[var(--accent-primary-hover)] transition-colors duration-300 px-2 py-1 rounded-lg hover:bg-[var(--accent-primary)]/10",children:"Choose files"})," ","or drag them here"]}),e.jsxs("p",{className:"text-sm text-[var(--text-tertiary)] mt-2 flex items-center justify-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 bg-[var(--control-bg)] px-2 py-1 rounded-md",children:[e.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z",clipRule:"evenodd"})}),"PNG"]}),e.jsxs("span",{className:"inline-flex items-center gap-1 bg-[var(--control-bg)] px-2 py-1 rounded-md",children:[e.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z",clipRule:"evenodd"})}),"JPG"]}),e.jsxs("span",{className:"inline-flex items-center gap-1 bg-[var(--control-bg)] px-2 py-1 rounded-md",children:[e.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z",clipRule:"evenodd"})}),"WebP"]})]})]})]}),e.jsx("input",{id:"file-upload",name:"file-upload",type:"file",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",accept:"image/*",multiple:!0,onChange:e=>{e.target.files&&e.target.files.length>0&&l(e.target.files)}})]}),e.jsx("div",{className:"divider-text my-6",children:e.jsx("span",{children:"OR"})}),e.jsx("input",{type:"file",accept:"image/*",capture:"environment",className:"hidden",id:"mobile-camera-input",onChange:e=>{e.target.files&&e.target.files.length>0&&(l(e.target.files),e.target.value="")}}),e.jsxs("label",{htmlFor:"mobile-camera-input",className:"w-full flex items-center justify-center bg-[var(--accent-primary)] hover:opacity-90 text-white font-bold py-3 px-4 rounded-xl transition-all duration-300 active:scale-[0.98] focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--card-bg)] focus-visible:ring-[var(--accent-primary)] cursor-pointer min-h-touch touch-target shadow-lg hover:shadow-xl",children:[e.jsx(p,{className:"w-5 h-5 mr-2"}),e.jsx("span",{children:"Quick Capture (Mobile)"})]}),o&&e.jsx("div",{className:"mt-6 animate-slide-up",children:e.jsxs("div",{className:"bg-[var(--accent-error)]/10 border border-[var(--accent-error)]/30 text-[var(--accent-error)] p-4 rounded-xl flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),e.jsx("p",{className:"font-medium",children:o})]})})]})})})})})},M=({onInstall:r,onDismiss:a})=>{const[s,o]=t.useState(null),[n,i]=t.useState(!1),[l,d]=t.useState(!1),[c,m]=t.useState("idle");t.useEffect(()=>{const e=window.matchMedia("(display-mode: standalone)").matches,t=!0===window.navigator.standalone,r="true"===localStorage.getItem("pwa-install-dismissed"),a="true"===localStorage.getItem("pwa-installed"),s=localStorage.getItem("pwa-last-prompt");!(r||a||e||t||s&&!(Date.now()-parseInt(s)>6048e5))&&i(!0)},[]),t.useEffect(()=>{const e=e=>{e.preventDefault();o(e)},t=()=>{m("success"),i(!1),localStorage.removeItem("pwa-install-dismissed"),localStorage.removeItem("pwa-last-prompt"),r?.()};return window.addEventListener("beforeinstallprompt",e),window.addEventListener("appinstalled",t),()=>{window.removeEventListener("beforeinstallprompt",e),window.removeEventListener("appinstalled",t)}},[r]);const x=null!==s,g=/Android/i.test(navigator.userAgent),u=/iPad|iPhone|iPod/.test(navigator.userAgent),p=window.matchMedia("(display-mode: standalone)").matches;return n&&!p&&(x||g||u)?e.jsxs(e.Fragment,{children:[n&&e.jsx("div",{className:"fixed bottom-4 left-4 right-4 z-50 animate-slide-up",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl shadow-2xl border border-blue-500/20 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center",children:e.jsx(f,{className:"w-6 h-6 text-white"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-white font-bold text-sm mb-1",children:"Install Image to Print Pro"}),e.jsx("p",{className:"text-blue-100 text-xs leading-relaxed mb-3",children:x?"Get the full app experience with offline support and home screen access":g?"Add to home screen for quick access and better performance":"Add to your home screen for a native app experience"}),e.jsxs("div",{className:"flex items-center gap-2",children:[x?e.jsx("button",{onClick:async()=>{if(s){d(!0),m("installing");try{await s.prompt();const{outcome:e}=await s.userChoice;"accepted"===e?(localStorage.removeItem("pwa-install-dismissed"),localStorage.setItem("pwa-installed","true"),r?.()):(localStorage.setItem("pwa-install-dismissed","true"),localStorage.setItem("pwa-last-prompt",Date.now().toString()),a?.()),o(null),i(!1)}catch(e){m("error"),setTimeout(()=>m("idle"),3e3)}finally{d(!1)}}},disabled:l,className:"flex items-center gap-1.5 bg-white text-blue-600 font-bold py-2 px-3 rounded-lg text-xs hover:bg-blue-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 active:scale-95",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),"Installing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"w-3 h-3"}),"Install App"]})}):g?e.jsxs("div",{className:"text-xs text-blue-100",children:[e.jsx("p",{className:"font-medium",children:"For Android:"}),e.jsx("p",{children:'Menu → "Add to Home screen"'})]}):u?e.jsxs("div",{className:"text-xs text-blue-100",children:[e.jsx("p",{className:"font-medium",children:"For iOS:"}),e.jsx("p",{children:'Share → "Add to Home Screen"'})]}):null,e.jsx("button",{onClick:()=>{i(!1),localStorage.setItem("pwa-install-dismissed","true"),localStorage.setItem("pwa-last-prompt",Date.now().toString()),a?.()},className:"p-1.5 text-blue-200 hover:text-white transition-colors","aria-label":"Dismiss",children:e.jsx(v,{className:"w-4 h-4"})})]})]})]})})}),"idle"!==c&&e.jsx("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 animate-slide-down",children:e.jsx("div",{className:"rounded-lg px-4 py-2 text-white text-sm font-medium shadow-lg "+("success"===c?"bg-green-600":"installing"===c?"bg-blue-600":"bg-red-600"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["success"===c&&e.jsx(w,{className:"w-4 h-4"}),"installing"===c&&e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"success"===c&&"App installed successfully!","installing"===c&&"Installing app...","error"===c&&"Installation failed. Please try again."]})})})]}):null},P=({onUpdate:r,onDismiss:a})=>{const[s,o]=t.useState(!1),[n,i]=t.useState(!1),[l,d]=t.useState(!1);t.useEffect(()=>{"serviceWorker"in navigator&&(navigator.serviceWorker.ready.then(e=>{e.addEventListener("updatefound",()=>{const t=e.installing;t&&t.addEventListener("statechange",()=>{"installed"===t.state&&navigator.serviceWorker.controller&&(i(!0),o(!0))})}),e.waiting&&(i(!0),o(!0))}),navigator.serviceWorker.addEventListener("message",e=>{e.data&&"UPDATE_AVAILABLE"===e.data.type&&(i(!0),o(!0))}));const e=()=>{const e="1.0.0",t=localStorage.getItem("app-version");t&&t!==e&&(i(!0),o(!0),localStorage.setItem("app-version",e))};return e(),window.addEventListener("focus",e),()=>{window.removeEventListener("focus",e)}},[]);return s&&n?e.jsx("div",{className:"fixed top-4 left-4 right-4 z-50 animate-slide-down",children:e.jsx("div",{className:"bg-gradient-to-r from-green-600 to-blue-600 rounded-xl shadow-2xl border border-green-500/20 p-4 backdrop-blur-sm android-notification",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center",children:e.jsx(j,{className:"w-6 h-6 text-white"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-white font-bold text-sm mb-1",children:"App Update Available"}),e.jsx("p",{className:"text-green-100 text-xs leading-relaxed mb-3",children:"A new version of Image to Print Pro is ready with improved features and bug fixes."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:async()=>{d(!0);try{if("serviceWorker"in navigator){const e=await navigator.serviceWorker.ready;e.waiting&&(e.waiting.postMessage({type:"SKIP_WAITING"}),navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()}))}r?.()}catch(e){d(!1)}},disabled:l,className:"flex items-center gap-1.5 bg-white text-green-600 font-bold py-2 px-3 rounded-lg text-xs hover:bg-green-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 active:scale-95",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-green-600 border-t-transparent rounded-full animate-spin"}),"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"w-3 h-3"}),"Update Now"]})}),e.jsx("button",{onClick:()=>{o(!1),a?.()},className:"p-1.5 text-green-200 hover:text-white transition-colors","aria-label":"Dismiss",children:e.jsx(v,{className:"w-4 h-4"})})]})]})]})})}):null},L=({onRetry:r})=>{const[a,s]=t.useState(navigator.onLine),[o,n]=t.useState(!1),[i,l]=t.useState(!1);t.useEffect(()=>{const e=()=>{s(!0),n(!1),l(!1)},t=()=>{s(!1),n(!0)};return window.addEventListener("online",e),window.addEventListener("offline",t),navigator.onLine||n(!0),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[]);return a?null:e.jsxs(e.Fragment,{children:[o&&e.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-gradient-to-r from-red-600 to-orange-600 text-white",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"You're Offline"}),e.jsx("p",{className:"text-xs text-red-100",children:"Some features may be limited"})]})]}),e.jsxs("button",{onClick:async()=>{l(!0);try{(await fetch("/",{method:"HEAD",cache:"no-cache"})).ok?(s(!0),n(!1),l(!1)):l(!1)}catch(e){l(!1)}r?.()},disabled:i,className:"flex items-center gap-1.5 bg-white/20 hover:bg-white/30 text-white font-medium py-1.5 px-3 rounded-lg text-xs transition-colors disabled:opacity-50",children:[e.jsx(k,{className:"w-4 h-4 "+(i?"animate-spin":"")}),i?"Checking...":"Retry"]})]})}),!o&&!a&&e.jsx("div",{className:"fixed top-4 right-4 z-40",children:e.jsx("div",{className:"bg-red-600 text-white rounded-full p-2 shadow-lg animate-pulse",children:e.jsx(y,{className:"w-5 h-5"})})}),a&&e.jsx("div",{className:"fixed top-4 right-4 z-40 opacity-0 animate-fade-in",children:e.jsx("div",{className:"bg-green-600 text-white rounded-full p-2 shadow-lg",children:e.jsx(N,{className:"w-5 h-5"})})})]})},E=t.createContext(null),_="processedImages",R="offlineActions";const I=new class{constructor(){this.db=null}async init(){return new Promise((e,t)=>{if(indexedDB&&"function"==typeof indexedDB.open)try{const t=indexedDB.open("ImageToPrintDB",1);t.onerror=()=>{e()},t.onsuccess=()=>{this.db=t.result,e()},t.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains(_)){t.createObjectStore(_,{keyPath:"id"}).createIndex("timestamp","timestamp",{unique:!1})}if(!t.objectStoreNames.contains(R)){const e=t.createObjectStore(R,{keyPath:"id"});e.createIndex("timestamp","timestamp",{unique:!1}),e.createIndex("type","type",{unique:!1})}}}catch(r){e()}else e()})}async saveProcessedImage(e){if(!this.db)throw new Error("Database not initialized");return new Promise((t,r)=>{const a=this.db.transaction([_],"readwrite").objectStore(_).put(e);a.onerror=()=>r(a.error),a.onsuccess=()=>t()})}async getProcessedImages(){if(!this.db)throw new Error("Database not initialized");return new Promise((e,t)=>{const r=this.db.transaction([_],"readonly").objectStore(_).getAll();r.onerror=()=>t(r.error),r.onsuccess=()=>{const t=r.result.sort((e,t)=>t.timestamp-e.timestamp);e(t)}})}async deleteProcessedImage(e){if(!this.db)throw new Error("Database not initialized");return new Promise((t,r)=>{const a=this.db.transaction([_],"readwrite").objectStore(_).delete(e);a.onerror=()=>r(a.error),a.onsuccess=()=>t()})}async saveOfflineAction(e){if(!this.db)throw new Error("Database not initialized");return new Promise((t,r)=>{const a=this.db.transaction([R],"readwrite").objectStore(R).put(e);a.onerror=()=>r(a.error),a.onsuccess=()=>t()})}async getOfflineActions(){if(!this.db)throw new Error("Database not initialized");return new Promise((e,t)=>{const r=this.db.transaction([R],"readonly").objectStore(R).getAll();r.onerror=()=>t(r.error),r.onsuccess=()=>{const t=r.result.sort((e,t)=>e.timestamp-t.timestamp);e(t)}})}async clearOfflineActions(){if(!this.db)throw new Error("Database not initialized");return new Promise((e,t)=>{const r=this.db.transaction([R],"readwrite").objectStore(R).clear();r.onerror=()=>t(r.error),r.onsuccess=()=>e()})}},z=({children:r})=>{const[a,s]=t.useState(navigator.onLine),[o,n]=t.useState(!1);t.useEffect(()=>{const e=()=>s(!0),t=()=>s(!1);return window.addEventListener("online",e),window.addEventListener("offline",t),I.init().then(()=>n(!0)).catch(e=>{n(!1)}),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[]);const i=async()=>{if(!a||!o)return;const e=await I.getOfflineActions();if(0!==e.length)for(const r of e)try{await I.clearOfflineActions();break}catch(t){r.retryCount++,r.retryCount<3&&await I.saveOfflineAction(r)}};t.useEffect(()=>{a&&o&&i()},[a,o]);const l={isOnline:a,isStorageReady:o,saveProcessedImage:async e=>{if(!o)throw new Error("Storage not ready");await I.saveProcessedImage(e)},getProcessedImages:async()=>o?I.getProcessedImages():[],deleteProcessedImage:async e=>{if(!o)throw new Error("Storage not ready");await I.deleteProcessedImage(e)},saveOfflineAction:async e=>{if(!o)throw new Error("Storage not ready");await I.saveOfflineAction(e)},getOfflineActions:async()=>o?I.getOfflineActions():[],clearOfflineActions:async()=>{if(!o)throw new Error("Storage not ready");await I.clearOfflineActions()},syncOfflineActions:i};return e.jsx(E.Provider,{value:l,children:r})},F=()=>{const e=t.useContext(E);if(!e)throw new Error("useOfflineStorage must be used within an OfflineStorageProvider");return e},W=({children:r,fallback:a,onError:s})=>{const[o,n]=t.useState(!1),[i,l]=t.useState(null);t.useEffect(()=>{const e=e=>{const t=new Error(e.message);t.stack=e.error?.stack;const r=t.message.includes("out of memory")||t.message.includes("Cannot allocate")||t.message.includes("Maximum call stack")||t.message.includes("Canvas")&&t.message.includes("memory");if(l(t),n(!0),"undefined"!=typeof window&&window.localStorage)try{const e={message:t.message,stack:t.stack,timestamp:(new Date).toISOString(),userAgent:navigator.userAgent,url:window.location.href,isMemoryError:r,deviceMemory:navigator.deviceMemory||"unknown",hardwareConcurrency:navigator.hardwareConcurrency||"unknown"},a=JSON.parse(window.localStorage.getItem("app_errors")||"[]");a.push(e),window.localStorage.setItem("app_errors",JSON.stringify(a.slice(-5)))}catch(a){}s?.(t,{componentStack:"Global error handler"})},t=e=>{const t=new Error(`Unhandled promise rejection: ${e.reason}`);t.stack=e.reason?.stack,l(t),n(!0),s?.(t,{componentStack:"Promise rejection handler"})};return window.addEventListener("error",e),window.addEventListener("unhandledrejection",t),()=>{window.removeEventListener("error",e),window.removeEventListener("unhandledrejection",t)}},[s]);const d=()=>{n(!1),l(null)};return o?a?e.jsx(e.Fragment,{children:a}):e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center p-4 bg-[var(--background)]",children:e.jsxs("div",{className:"bg-[var(--card-bg)] border border-[var(--card-border)] rounded-2xl p-6 max-w-md w-full text-center shadow-lg",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-xl font-bold text-[var(--text-primary)] mb-2",children:"Oops! Something went wrong"}),e.jsx("p",{className:"text-[var(--text-secondary)] mb-4 text-sm",children:i?.message.includes("out of memory")||i?.message.includes("Cannot allocate")?"The app ran out of memory. Try closing other apps, using smaller images, or restarting your device.":"The app encountered an unexpected error. This has been logged for debugging."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>window.location.reload(),className:"w-full bg-[var(--accent-primary)] hover:opacity-90 text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 active:scale-[0.98]",children:"Reload App"}),e.jsx("button",{onClick:d,className:"w-full bg-[var(--control-bg)] hover:bg-[var(--control-bg)]/80 text-[var(--text-secondary)] font-bold py-2 px-4 rounded-lg transition-colors duration-200",children:"Try Again"}),(i?.message.includes("out of memory")||i?.message.includes("Cannot allocate"))&&e.jsx("button",{onClick:()=>{"caches"in window&&caches.keys().then(e=>{e.forEach(e=>caches.delete(e))}),localStorage.clear(),sessionStorage.clear(),window.location.reload()},className:"w-full bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200",children:"Clear Cache & Reload"})]}),"undefined"!=typeof process&&!1]})}):e.jsx(e.Fragment,{children:r})},O=[{name:"India Passport (35x45 mm)",width_mm:35,height_mm:45},{name:"PAN Card (25x35 mm)",width_mm:25,height_mm:35},{name:"Stamp Size (20x25 mm)",width_mm:20,height_mm:25},{name:"Custom Size",width_mm:0,height_mm:0},{name:"Random Size",width_mm:-1,height_mm:-1}],D={width:210,height:297};function T(e,t,r){return a(s({unit:"%",width:90},r,e,t),e,t)}const A=async(e,t,r,a,s,o)=>{const n=e.getContext("2d");if(!(n instanceof CanvasRenderingContext2D||n instanceof OffscreenCanvasRenderingContext2D))return e.width=1,e.height=1,null;if(!r.width||!r.height||a.width_mm<=0)return e.width=1,e.height=1,n.clearRect(0,0,1,1),null;const{borderWidth_mm:i,borderColor:l,borderPosition:d,addStroke:c}=s,{isPreview:h,dpi:m}=o;let x,g,u;if(h){const e=200;x=e,g=e/(a.width_mm/a.height_mm),u=x/a.width_mm}else{u=(m||300)/25.4,x=Math.round(a.width_mm*u),g=Math.round(a.height_mm*u)}const p=navigator.deviceMemory||4,b=navigator.hardwareConcurrency||4;if(p<4||b<4){const e=Math.min(p/4,b/4,1);x=Math.round(x*e),g=Math.round(g*e),u*=e}const v=i>0?Math.max(1,Math.round(i*u)):0,f=c?Math.max(1,Math.round(.1*u)):0;e.width=x,e.height=g,n.imageSmoothingEnabled=!0,n.imageSmoothingQuality=p<4?"low":"high",n.clearRect(0,0,x,g);const w=t.naturalWidth/t.width,j=t.naturalHeight/t.height,y=r.x*w,N=r.y*j,k=r.width*w,S=r.height*j;if(x<=0||g<=0||k<=0||S<=0)return null;n.fillStyle=l,n.fillRect(0,0,x,g);const C="outer"===d&&v>0?v:0,M="outer"===d&&v>0?v:0,P=x-("outer"===d&&v>0?2*v:0),L=g-("outer"===d&&v>0?2*v:0);if(n.drawImage(t,y,N,k,S,C,M,P,L),"inner"===d&&v>0&&(n.strokeStyle=l,n.lineWidth=2*v,n.strokeRect(0,0,x,g)),c&&f>0){n.strokeStyle="#000000",n.lineWidth=f;const e=v+f/2;x>2*e&&g>2*e&&n.strokeRect(e,e,x-2*e,g-2*e)}return e instanceof OffscreenCanvas?await e.convertToBlob({type:"image/png",quality:.95}):new Promise(t=>{e.toBlob(t,"image/png",.95)})},$=Object.freeze(Object.defineProperty({__proto__:null,default:({imageSrc:a,onProcess:s,onBack:o,queuePosition:i,queueLength:d,sheetMode:x})=>{const[g,u]=t.useState(a),[p,v]=t.useState(null),[f,w]=t.useState(!1),[j,y]=t.useState(null),[N,k]=t.useState(O[0].name),[S,C]=t.useState({width_mm:0,height_mm:0}),[M,P]=t.useState(300),[L,E]=t.useState(),[_,R]=t.useState(),[I,z]=t.useState(.5),F="#FFFFFF",[W,D]=t.useState("outer"),[$,B]=t.useState(!1),[H,U]=t.useState(300),[G,q]=t.useState(""),[V,Q]=t.useState(!1),[J,Y]=t.useState({width:0,height:0}),K=t.useRef(null),Z=t.useRef(null),X=t.useRef(null),ee=!!x;t.useEffect(()=>{x&&("standard"===x.mode&&x.size?k(x.size.name):"random"===x.mode&&k("Random Size"))},[x]);const te=t.useMemo(()=>"Custom Size"===N?{name:"Custom Size",...S}:"Random Size"===N?{name:"Random Size",width_mm:-1,height_mm:-1}:O.find(e=>e.name===N)||O[0],[N,S]),re="Custom Size"===N,ae="Random Size"===N,se=re?void 0:!ae&&te.width_mm>0&&te.height_mm>0?te.width_mm/te.height_mm:void 0;function oe(e){if(se){const{width:t,height:r}=e.currentTarget;E(T(t,r,se))}}t.useEffect(()=>{u(a),y(null),p&&(URL.revokeObjectURL(p),v(null))},[a]),t.useEffect(()=>{K.current&&E(void 0)},[g]),t.useEffect(()=>()=>{p&&URL.revokeObjectURL(p)},[p]),t.useEffect(()=>()=>{try{const t=navigator.deviceMemory||4;if(Z.current){const e=Z.current.getContext("2d");e&&e.clearRect(0,0,Z.current.width,Z.current.height),Z.current.width=1,Z.current.height=1}X.current&&(X.current.width=1,X.current.height=1,X.current=null);if(document.querySelectorAll("canvas").forEach(e=>{if(e!==Z.current){const t=e.getContext("2d");t&&t.clearRect(0,0,e.width,e.height),e.width=1,e.height=1}}),window.gc&&t<4)try{performance.now()-window.lastGC>1e4&&(window.gc(),window.lastGC=performance.now())}catch(e){}}catch(t){}},[]),t.useEffect(()=>{if(K.current&&se){const{width:e,height:t}=K.current;e>0&&t>0&&E(T(e,t,se))}},[se]),t.useEffect(()=>{"undefined"!=typeof OffscreenCanvas&&(X.current=new OffscreenCanvas(1,1))},[]),t.useEffect(()=>{if(_?.width&&_?.height&&K.current&&"Random Size"!==te.name){const e=setTimeout(async()=>{try{const t=X.current||Z.current;if(!t)return;const r=navigator.deviceMemory||4;if(r<2){const e=t.getContext("2d");e&&(e.imageSmoothingQuality="low")}const a=await A(t,K.current,_,te,{borderWidth_mm:I,borderColor:F,borderPosition:W,addStroke:$},{isPreview:!0});if(a&&Z.current)try{const e=await createImageBitmap(a),t=Z.current.getContext("2d");if(t){const a=r<4?150:200,s=e.width/e.height;let o=Math.min(e.width,a),n=o/s;n>a&&(n=a,o=n*s),Z.current.width=o,Z.current.height=n,t.clearRect(0,0,o,n),t.drawImage(e,0,0,o,n)}e.close()}catch(e){}}catch(t){}},300);return()=>{if(clearTimeout(e),Z.current){const e=Z.current.getContext("2d");e&&e.clearRect(0,0,Z.current.width,Z.current.height)}}}},[_,I,W,$,te]),t.useEffect(()=>{if(!_?.width||!K.current||!te||te.width_mm<=0)return q(""),void Y({width:0,height:0});Q(!0);const e=setTimeout(async()=>{let e=null;try{const t=H/25.4,r=Math.round(te.width_mm*t),a=Math.round(te.height_mm*t);Y({width:r,height:a}),e=X.current||document.createElement("canvas");const s=(navigator.deviceMemory||4)<4?2e6:8e6,o=r*a;if(o>s){const t=Math.sqrt(s/o),n=Math.round(r*t),i=Math.round(a*t);Y({width:n,height:i}),e=document.createElement("canvas")}const n=await A(e,K.current,_,te,{borderWidth_mm:I,borderColor:F,borderPosition:W,addStroke:$},{isPreview:!1,dpi:H});q(n?function(e,t=2){if(0===e)return"0 Bytes";const r=t<0?0:t,a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(r))+" "+["Bytes","KB","MB","GB","TB"][a]}(n.size):"N/A"),Q(!1)}catch(t){q("N/A"),Y({width:0,height:0}),Q(!1)}finally{if(e&&!X.current){const t=e,r=t.getContext("2d");r&&r.clearRect(0,0,t.width,t.height),t.width=1,t.height=1}}},600);return()=>{clearTimeout(e),Q(!1)}},[H,_,te,I,F,W,$]),t.useEffect(()=>{if(re&&_?.width&&_?.height&&K.current){const e=K.current,t=e.naturalWidth/e.width,r=e.naturalHeight/e.height,a=_.width*t,s=_.height*r;if(M>0){C({width_mm:a/M*25.4,height_mm:s/M*25.4})}}},[_,M,re]);const ne=async(e="print")=>{if(K.current)try{if(ae){const t=g,r={width:K.current.naturalWidth,height:K.current.naturalHeight};s(t,te,r,e)}else{if(!_?.width)return;const t=document.createElement("canvas"),r=navigator.deviceMemory||4,a=r<4?3e6:12e6,o=r<4?Math.min(300,H):H,n=o/25.4,i=Math.round(te.width_mm*n),l=Math.round(te.height_mm*n),d=i*l;if(d>a){const e=Math.sqrt(a/d),r=Math.round(o*e)/25.4;t.width=Math.round(te.width_mm*r),t.height=Math.round(te.height_mm*r)}else t.width=i,t.height=l;const c=await A(t,K.current,_,te,{borderWidth_mm:I,borderColor:F,borderPosition:W,addStroke:$},{isPreview:!1,dpi:o});if(!c)throw new Error("Failed to generate image blob for processing.");{const r=await new Promise((e,t)=>{const r=new FileReader;r.onloadend=()=>e(r.result),r.onerror=()=>t(new Error("Failed to read processed image")),r.readAsDataURL(c)}),a=t.getContext("2d");a&&a.clearRect(0,0,t.width,t.height),s(r,te,void 0,e)}}}catch(t){(navigator.deviceMemory||4)<4?alert("Processing failed due to device memory limitations. Please try with a smaller image or restart the app."):alert("Processing failed. Please try again or contact support if the issue persists.")}},ie=g!==a;return e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 sm:gap-6 safe-bottom",children:[e.jsxs("div",{className:"flex-grow bg-[var(--card-bg)] backdrop-blur-sm border border-[var(--card-border)] rounded-2xl shadow-lg shadow-[var(--shadow-color)] p-3 sm:p-4 md:p-6 flex flex-col",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold mb-3 sm:mb-4 text-[var(--text-primary)]",children:ae||re?"Image Preview":"Crop Your Image"}),d&&d>1&&i&&e.jsx("div",{className:"text-center mb-3 sm:mb-4 bg-[var(--control-bg)]/80 p-2 rounded-lg",children:e.jsxs("p",{className:"font-semibold text-[var(--accent-primary)] text-sm sm:text-base",children:["Processing image ",i," of ",d]})}),e.jsx("div",{className:"bg-black/50 rounded-lg flex-grow flex justify-center items-center min-h-[35vh] sm:min-h-[40vh]",children:ae?e.jsx("img",{ref:K,src:g,alt:"Preview",className:"max-h-[50vh] sm:max-h-[65vh] object-contain",onLoad:oe,crossOrigin:"anonymous"}):e.jsx(r,{crop:L,onChange:e=>E(e),onComplete:e=>R(e),aspect:se,className:"max-h-[50vh] sm:max-h-[65vh] flex items-center justify-center",children:e.jsx("img",{ref:K,src:g,alt:"Crop preview",className:"max-h-[50vh] sm:max-h-[65vh] object-contain",onLoad:oe,crossOrigin:"anonymous"})})})]}),e.jsxs("div",{className:"lg:w-[380px] flex-shrink-0 flex flex-col gap-y-4 sm:gap-y-6",children:[e.jsxs("div",{className:"bg-[var(--card-bg)] backdrop-blur-sm border border-[var(--card-border)] rounded-2xl shadow-lg shadow-[var(--shadow-color)] p-4 sm:p-6 flex flex-col space-y-3",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-[var(--text-primary)] -mt-1 mb-1",children:"Finalize Image"}),e.jsxs("button",{onClick:()=>ne("print"),disabled:ae?!K.current:!_?.width,className:"w-full flex items-center justify-center bg-[var(--accent-primary)] hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-3 sm:py-3 px-4 rounded-lg transition-all duration-200 active:scale-[0.98] focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--card-bg)] focus-visible:ring-[var(--accent-primary)] min-h-touch touch-target",children:[e.jsx(l,{className:"w-5 h-5 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Add to "}),"Print Sheet"]}),e.jsxs("button",{onClick:()=>ne("upload"),className:"w-full flex items-center justify-center bg-[var(--control-bg)] hover:bg-[var(--control-bg)]/80 text-[var(--text-secondary)] font-bold py-2 sm:py-2 px-4 rounded-lg transition-colors duration-200 active:scale-[0.98] min-h-touch touch-target",children:[e.jsx(b,{className:"w-5 h-5 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Add & "}),"Upload More"]}),e.jsxs("button",{onClick:o,className:"w-full flex items-center justify-center bg-[var(--control-bg)] hover:bg-[var(--control-bg)]/80 text-[var(--text-secondary)] font-bold py-2 sm:py-2 px-4 rounded-lg transition-colors duration-200 active:scale-[0.98] min-h-touch touch-target",children:[e.jsx(c,{className:"w-5 h-5 mr-2"}),"Start Over"]})]}),e.jsxs("div",{className:"bg-[var(--card-bg)] backdrop-blur-sm border border-[var(--card-border)] rounded-2xl shadow-lg shadow-[var(--shadow-color)] p-6 flex flex-col",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-[var(--text-primary)]",children:"Editing Options"}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"size-select",className:"block text-sm font-medium text-[var(--text-secondary)] mb-1.5",children:"Passport Size"}),e.jsx("select",{id:"size-select",value:N,onChange:e=>{k(e.target.value),"Custom Size"===e.target.value&&(E(void 0),R(void 0),C({width_mm:0,height_mm:0}))},disabled:ee,className:"w-full bg-[var(--control-bg)] border border-[var(--control-border)] rounded-md py-2 px-3 text-[var(--text-primary)] focus:ring-[var(--accent-primary)] focus:border-[var(--accent-primary)] transition disabled:opacity-70 disabled:cursor-not-allowed",children:O.map(t=>e.jsx("option",{value:t.name,children:t.name},t.name))}),ee&&e.jsx("p",{className:"mt-2 text-xs text-[var(--text-tertiary)] p-2 bg-[var(--control-bg)]/80 rounded-md border border-[var(--control-border)]",children:'Size is locked to match the current print sheet. To use a different size, please "Start Over".'})]}),re&&e.jsxs("div",{className:"p-3 bg-[var(--control-bg)]/80 rounded-md border border-[var(--control-border)] space-y-3",children:[e.jsx("p",{className:"text-xs text-center text-[var(--text-tertiary)] -mt-1",children:"Draw a crop box on the image to define its physical size."}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"source-dpi",className:"block text-xs font-medium text-[var(--text-secondary)] mb-1",children:"Source Image DPI"}),e.jsx("input",{type:"number",id:"source-dpi",value:M,onChange:e=>P(Math.max(1,Number(e.target.value))),min:"1",className:"w-full bg-[var(--background-start-rgb)] border border-[var(--control-border)] rounded-md py-1 px-2 text-sm text-[var(--text-primary)] focus:ring-[var(--accent-primary)] focus:border-[var(--accent-primary)]"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-[var(--text-secondary)] mb-1",children:"Calculated Width"}),e.jsxs("div",{className:"w-full bg-[var(--background-start-rgb)] border border-[var(--control-border)] rounded-md py-1 px-2 text-sm text-[var(--text-primary)] truncate",children:[S.width_mm.toFixed(1)," mm"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-[var(--text-secondary)] mb-1",children:"Calculated Height"}),e.jsxs("div",{className:"w-full bg-[var(--background-start-rgb)] border border-[var(--control-border)] rounded-md py-1 px-2 text-sm text-[var(--text-primary)] truncate",children:[S.height_mm.toFixed(1)," mm"]})]})]})]}),ae&&e.jsx("div",{className:"p-3 bg-[var(--control-bg)]/80 rounded-md border border-[var(--control-border)] text-center",children:e.jsx("p",{className:"text-sm text-[var(--text-secondary)]",children:"The crop step is skipped for 'Random Size'. The full image will be added to the print sheet."})}),!ae&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 bg-gradient-to-br from-purple-500/10 to-indigo-500/10 rounded-lg border border-[var(--control-border)] space-y-3",children:[e.jsx("h3",{className:"text-sm font-medium text-[var(--text-secondary)] -mt-1",children:"Background Removal Tool"}),e.jsxs("button",{onClick:async()=>{y(null),w(!0);try{const e=await n(g);p&&URL.revokeObjectURL(p);const t=await fetch(e),r=await t.blob(),a=URL.createObjectURL(r);v(a),u(e)}catch(e){let t="Sorry, there was an error removing the background using the built-in tool.";e instanceof Error&&(t=e.message.includes("Failed to load image")?"Could not load the image for processing. Please try a different image.":e.message.includes("Failed to get canvas context")?"Canvas is not supported in this browser.":e.message),y(t)}finally{w(!1)}},disabled:f||ie,className:"w-full flex items-center justify-center bg-gradient-to-r from-purple-600 to-indigo-600 hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-2 px-4 rounded-lg transition-all duration-300 active:scale-95",children:[e.jsx(m,{className:"w-5 h-5 mr-2"}),f?"Processing...":"Remove Background"]}),ie&&e.jsx("button",{onClick:()=>{u(a),p&&(URL.revokeObjectURL(p),v(null))},className:"w-full text-center text-sm text-[var(--text-secondary)] hover:text-[var(--accent-primary)] py-1 transition-colors",children:"Restore Original"}),j&&e.jsxs("div",{className:"mt-2 text-sm text-yellow-400 bg-yellow-900/50 border border-yellow-800 p-3 rounded-md",role:"alert",children:[e.jsx("p",{className:"font-bold",children:"Processing Error"}),e.jsx("p",{children:j})]}),e.jsx("p",{className:"text-xs text-[var(--text-tertiary)] text-center pt-2",children:"Built-in tool: Background will be replaced with solid white."})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"border-width-slider",className:"flex justify-between text-sm font-medium text-[var(--text-secondary)] mb-1.5",children:[e.jsx("span",{children:"Border Width"}),e.jsxs("span",{className:"font-bold text-[var(--accent-primary)]",children:[I.toFixed(1)," mm"]})]}),e.jsx("input",{type:"range",id:"border-width-slider",name:"border-width-slider",value:I,onChange:e=>z(Number(e.target.value)),min:"0",max:"10",step:"0.1",className:"w-full h-2 bg-[var(--control-bg)] rounded-lg appearance-none cursor-pointer accent-[var(--accent-primary)]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-1.5",children:"Border Position"}),e.jsxs("div",{className:"flex w-full bg-[var(--control-bg)] rounded-md p-1 border border-[var(--control-border)]",children:[e.jsx("button",{onClick:()=>D("outer"),className:"w-1/2 py-1.5 text-sm font-semibold rounded-md transition-colors "+("outer"===W?"bg-[var(--accent-primary)] text-white":"text-[var(--text-secondary)] hover:bg-black/5"),children:"Outer"}),e.jsx("button",{onClick:()=>D("inner"),className:"w-1/2 py-1.5 text-sm font-semibold rounded-md transition-colors "+("inner"===W?"bg-[var(--accent-primary)] text-white":"text-[var(--text-secondary)] hover:bg-black/5"),children:"Inner"})]})]}),e.jsxs("div",{className:"flex items-center justify-between bg-[var(--control-bg)]/80 p-3 rounded-lg",children:[e.jsx("label",{htmlFor:"stroke-toggle",className:"text-sm font-medium text-[var(--text-secondary)]",children:"Add 0.1mm Black Stroke"}),e.jsx("button",{id:"stroke-toggle",role:"switch","aria-checked":$,onClick:()=>B(e=>!e),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--card-bg)] focus-visible:ring-[var(--accent-primary)] "+($?"bg-[var(--accent-primary)]":"bg-[var(--control-border)]"),children:e.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+($?"translate-x-6":"translate-x-1")})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-[var(--text-secondary)] mb-1.5",children:"Live Preview"}),e.jsx("div",{className:"bg-[var(--control-bg)]/50 dark:bg-black/20 rounded-lg p-4 flex flex-col justify-center items-center min-h-[150px] border border-[var(--control-border)]",children:ae?e.jsx("p",{className:"text-xs text-center text-[var(--text-tertiary)]",children:"Preview is available on the final print page for 'Random Size' images."}):e.jsxs(e.Fragment,{children:[e.jsx("canvas",{ref:Z,className:"max-w-full h-auto rounded shadow-lg shadow-[var(--shadow-color)]"}),te.width_mm>0&&e.jsxs("p",{className:"text-xs text-[var(--text-tertiary)] font-medium mt-3 bg-[var(--control-bg)] px-2 py-1 rounded-full",children:[te.width_mm.toFixed(1),"mm x"," ",te.height_mm.toFixed(1),"mm"]})]})})]})]})]})]}),!ae&&e.jsxs("div",{className:"bg-[var(--card-bg)] backdrop-blur-sm border border-[var(--card-border)] rounded-2xl shadow-lg shadow-[var(--shadow-color)] p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-[var(--text-primary)] mb-4",children:"Download Single Image"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"dpi-slider",className:"flex justify-between text-sm font-medium text-[var(--text-secondary)] mb-1.5",children:[e.jsx("span",{children:"Resolution (DPI)"}),e.jsxs("span",{className:"font-bold text-[var(--accent-primary)]",children:[H," DPI"]})]}),e.jsx("input",{id:"dpi-slider",type:"range",min:"72",max:"600",step:"1",value:H,onChange:e=>U(Number(e.target.value)),className:"w-full h-2 bg-[var(--control-bg)] rounded-lg appearance-none cursor-pointer accent-[var(--accent-primary)]","aria-label":"Download resolution in DPI"})]}),e.jsxs("div",{className:"text-center space-y-1 text-xs text-[var(--text-secondary)] p-3 bg-[var(--control-bg)]/80 rounded-lg",children:[e.jsxs("p",{children:[e.jsxs("span",{className:"font-semibold text-[var(--text-secondary)]",children:["Physical Size:"," "]}),e.jsx("span",{className:"font-semibold text-[var(--text-primary)]",children:te.width_mm>0?`${te.width_mm.toFixed(1)}mm x ${te.height_mm.toFixed(1)}mm`:"N/A"})]}),e.jsxs("p",{children:[e.jsxs("span",{className:"font-semibold text-[var(--text-secondary)]",children:["Pixel Dimensions:"," "]}),e.jsx("span",{className:"font-semibold text-[var(--text-primary)]",children:J.width>0?`${J.width} x ${J.height} px`:"N/A"})]})]}),e.jsxs("div",{className:"text-sm text-center bg-[var(--control-bg)]/80 p-2 rounded-md border border-[var(--control-border)]",children:[e.jsxs("span",{className:"text-[var(--text-secondary)]",children:["Est. File Size:"," "]}),e.jsx("span",{className:"font-semibold text-[var(--text-primary)] h-5 inline-block w-20",children:V?"...":G})]}),e.jsxs("button",{onClick:async()=>{if(!_||!K.current||!te||te.width_mm<=0)return;const e=X.current||document.createElement("canvas");try{const t=await A(e,K.current,_,te,{borderWidth_mm:I,borderColor:F,borderPosition:W,addStroke:$},{isPreview:!1,dpi:H});if(!t)throw new Error("Failed to generate image blob for download.");{const e=URL.createObjectURL(t),r=document.createElement("a");r.href=e;const a=te.name.replace(/[^a-zA-Z0-9]/g,"_");r.download=`passport_photo_${a}_${H}dpi.jpg`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(e)}}catch(t){alert("Download failed due to memory constraints. Try with a lower DPI setting.")}},disabled:!_?.width||V,className:"w-full flex items-center justify-center bg-[var(--accent-secondary)] hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-2.5 px-4 rounded-lg transition-all duration-200 active:scale-[0.98]",children:[e.jsx(h,{className:"w-5 h-5 mr-2"}),"Download Image"]})]})]})]})]})}},Symbol.toStringTag,{value:"Module"})),B=e=>e/25.4*300,H=10,U=(e,t,r,a,s,o)=>{if(!r||"Random Size"===r.name)return{portrait:0,landscape:0,max:0,rotateForMax:!1};const n=e-a.left-a.right,i=t-a.top-a.bottom;if(n<=0||i<=0)return{portrait:0,landscape:0,max:0,rotateForMax:!1};const l=o?0:2,d=s&&!o?2/300*25.4:0,c=B(n),h=B(i),m=B(l),x=B(d),g=B(r.width_mm)+2*x,u=B(r.height_mm)+2*x,p=(g>0?Math.floor((c+m)/(g+m)):0)*(u>0?Math.floor((h+m)/(u+m)):0),b=B(r.height_mm)+2*x,v=B(r.width_mm)+2*x,f=(b>0?Math.floor((c+m)/(b+m)):0)*(v>0?Math.floor((h+m)/(v+m)):0);return{portrait:p,landscape:f,max:Math.max(p,f),rotateForMax:f>p}},G=({page:t,showCutMarks:r,paperDimensions:a,margins:s,noGap:o})=>{const n=B(a.width),i=B(a.height),l={position:"absolute",background:"black"},d=B(r&&!o?2:0),c=t.length>0&&"Random Size"===t[0].size.name;return e.jsx("div",{id:"print-area",className:"bg-white shadow-lg mx-auto",style:{width:`${n}px`,height:`${i}px`,position:"relative"},children:e.jsx("div",{className:"printable-area",style:{position:"absolute",top:`${B(s.top)}px`,left:`${B(s.left)}px`,width:`${B(a.width-s.left-s.right)}px`,height:`${B(a.height-s.top-s.bottom)}px`},children:t.map((t,a)=>{const s=c?t.renderWidth-2*d:B(t.size.width_mm),n=c?t.renderHeight-2*d:B(t.size.height_mm);return e.jsxs("div",{className:"absolute",style:{left:`${t.x}px`,top:`${t.y}px`,width:`${t.renderWidth}px`,height:`${t.renderHeight}px`,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("img",{src:t.dataUrl,alt:"Print",style:{width:`${s}px`,height:`${n}px`,objectFit:"cover",transform:`rotate(${90===t.rotation?"90deg":"0deg"})`}}),r&&!c&&(o?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{...l,top:0,left:0,width:"1px",height:"10px"}}),e.jsx("div",{style:{...l,top:0,left:0,width:"10px",height:"1px"}}),e.jsx("div",{style:{...l,top:0,right:0,width:"1px",height:"10px"}}),e.jsx("div",{style:{...l,top:0,right:0,width:"10px",height:"1px"}}),e.jsx("div",{style:{...l,bottom:0,left:0,width:"1px",height:"10px"}}),e.jsx("div",{style:{...l,bottom:0,left:0,width:"10px",height:"1px"}}),e.jsx("div",{style:{...l,bottom:0,right:0,width:"1px",height:"10px"}}),e.jsx("div",{style:{...l,bottom:0,right:0,width:"10px",height:"1px"}})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{...l,top:"0px",left:`${d}px`,width:"1px",height:"10px"}}),e.jsx("div",{style:{...l,top:`${d}px`,left:"0px",width:"10px",height:"1px"}}),e.jsx("div",{style:{...l,top:"0px",right:`${d}px`,width:"1px",height:"10px"}}),e.jsx("div",{style:{...l,top:`${d}px`,right:"0px",width:"10px",height:"1px"}}),e.jsx("div",{style:{...l,bottom:"0px",left:`${d}px`,width:"1px",height:"10px"}}),e.jsx("div",{style:{...l,bottom:`${d}px`,left:"0px",width:"10px",height:"1px"}}),e.jsx("div",{style:{...l,bottom:"0px",right:`${d}px`,width:"1px",height:"10px"}}),e.jsx("div",{style:{...l,bottom:`${d}px`,right:"0px",width:"10px",height:"1px"}})]}))]},`${t.id}-${a}`)})})})},q=({page:t,showCutMarks:r,paperDimensions:a,margins:s,noGap:o})=>{const{width:n,height:i}=a,l=n-s.left-s.right,d=i-s.top-s.bottom;if(l<=0||d<=0)return e.jsx("div",{className:"w-full bg-white/10 flex items-center justify-center text-red-400 p-4 text-center rounded-md",style:{aspectRatio:`${n||1} / ${i||1}`},children:"Invalid margin settings. Printable area has zero or negative size."});const c=t.length>0&&"Random Size"===t[0].size.name,h=B(l),m=B(d),x=B(r&&!o?2:0);return e.jsx("div",{className:"w-full max-w-full max-h-full bg-white shadow-xl relative border border-slate-300 dark:border-slate-600",style:{aspectRatio:`${n} / ${i}`},children:e.jsx("div",{className:"absolute",style:{top:s.top/i*100+"%",left:s.left/n*100+"%",width:l/n*100+"%",height:d/i*100+"%"},children:t.map((t,a)=>{const s={position:"absolute",left:t.x/h*100+"%",top:t.y/m*100+"%",width:t.renderWidth/h*100+"%",height:t.renderHeight/m*100+"%",display:"flex",alignItems:"center",justifyContent:"center"},n=c?t.renderWidth-2*x:B(t.size.width_mm),i=c?t.renderHeight-2*x:B(t.size.height_mm),l="1px",d="8px",g=t.renderWidth>0?x/t.renderWidth*100:0,u=t.renderHeight>0?x/t.renderHeight*100:0;return e.jsxs("div",{style:s,children:[e.jsx("img",{src:t.dataUrl,alt:"Print preview",style:{width:(t.renderWidth>0?n/t.renderWidth*100:0)+"%",height:(t.renderHeight>0?i/t.renderHeight*100:0)+"%",position:"absolute",objectFit:"cover",transform:`rotate(${90===t.rotation?"90deg":"0deg"})`}}),r&&!c&&e.jsx("div",{className:"absolute w-full h-full",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute bg-black",style:{top:0,left:0,width:l,height:d}}),e.jsx("div",{className:"absolute bg-black",style:{top:0,left:0,width:d,height:l}}),e.jsx("div",{className:"absolute bg-black",style:{top:0,right:0,width:l,height:d}}),e.jsx("div",{className:"absolute bg-black",style:{top:0,right:0,width:d,height:l}}),e.jsx("div",{className:"absolute bg-black",style:{bottom:0,left:0,width:l,height:d}}),e.jsx("div",{className:"absolute bg-black",style:{bottom:0,left:0,width:d,height:l}}),e.jsx("div",{className:"absolute bg-black",style:{bottom:0,right:0,width:l,height:d}}),e.jsx("div",{className:"absolute bg-black",style:{bottom:0,right:0,width:d,height:l}})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute bg-black",style:{top:"0px",left:`${g}%`,width:l,height:d}}),e.jsx("div",{className:"absolute bg-black",style:{top:`${u}%`,left:"0px",width:d,height:l}}),e.jsx("div",{className:"absolute bg-black",style:{top:"0px",right:`${g}%`,width:l,height:d}}),e.jsx("div",{className:"absolute bg-black",style:{top:`${u}%`,right:"0px",width:d,height:l}}),e.jsx("div",{className:"absolute bg-black",style:{bottom:"0px",left:`${g}%`,width:l,height:d}}),e.jsx("div",{className:"absolute bg-black",style:{bottom:`${u}%`,left:"0px",width:d,height:l}}),e.jsx("div",{className:"absolute bg-black",style:{bottom:"0px",right:`${g}%`,width:l,height:d}}),e.jsx("div",{className:"absolute bg-black",style:{bottom:`${u}%`,right:"0px",width:d,height:l}})]})})]},`${t.id}-${a}`)})})})},V=async t=>{try{return await(async e=>{const{page:t,showCutMarks:r,paperDimensions:a,margins:s,noGap:o}=e,n=B(a.width),i=B(a.height),l=document.createElement("canvas");l.width=n,l.height=i;const d=l.getContext("2d");if(!d)throw new Error("Failed to get 2D context from canvas.");d.fillStyle="white",d.fillRect(0,0,n,i);const c=await Promise.all(t.map(e=>new Promise((t,r)=>{const a=new Image;a.onload=()=>t(a),a.onerror=t=>r(new Error(`Failed to load image: ${e.id}`)),a.src=e.dataUrl}))),h=B(s.left),m=B(s.top),x=t.length>0&&"Random Size"===t[0].size.name,g=B(r&&!o?2:0);d.strokeStyle="black",d.lineWidth=1;for(let u=0;u<t.length;u++){const e=t[u],a=c[u],s=h+e.x,n=m+e.y,i=x?e.renderWidth-2*g:B(e.size.width_mm),l=x?e.renderHeight-2*g:B(e.size.height_mm),p=s+(e.renderWidth-i)/2,b=n+(e.renderHeight-l)/2;d.save(),90===e.rotation?(d.translate(p+i/2,b+l/2),d.rotate(90*Math.PI/180),d.drawImage(a,-l/2,-i/2,l,i)):d.drawImage(a,p,b,i,l),d.restore(),r&&!x&&(o?(d.beginPath(),d.moveTo(s,n+H),d.lineTo(s,n),d.lineTo(s+H,n),d.moveTo(s+e.renderWidth-H,n),d.lineTo(s+e.renderWidth,n),d.lineTo(s+e.renderWidth,n+H),d.moveTo(s,n+e.renderHeight-H),d.lineTo(s,n+e.renderHeight),d.lineTo(s+H,n+e.renderHeight),d.moveTo(s+e.renderWidth-H,n+e.renderHeight),d.lineTo(s+e.renderWidth,n+e.renderHeight),d.lineTo(s+e.renderWidth,n+e.renderHeight-H),d.stroke()):(d.beginPath(),d.moveTo(p,b+H),d.lineTo(p,b),d.lineTo(p+H,b),d.moveTo(p+i-H,b),d.lineTo(p+i,b),d.lineTo(p+i,b+H),d.moveTo(p,b+l-H),d.lineTo(p,b+l),d.lineTo(p+H,b+l),d.moveTo(p+i-H,b+l),d.lineTo(p+i,b+l),d.lineTo(p+i,b+l-H),d.stroke()))}return l})(t)}catch(r){try{return await(async t=>{const r=document.createElement("div");r.style.position="absolute",r.style.left="-9999px",r.style.top="-9999px",document.body.appendChild(r);let a=null;try{a=o.createRoot(r),await new Promise(r=>{a.render(e.jsx(G,{...t})),setTimeout(r,200)});const s=r.querySelector("#print-area");if(!s)throw new Error("Could not find #print-area element for capturing.");return await html2canvas(s,{scale:1,backgroundColor:"#ffffff",onclone:e=>{const t=e.querySelector("#print-area");t&&(t.style.backgroundColor="white")}})}finally{a&&a.unmount(),document.body.removeChild(r)}})(t)}catch(a){throw new Error("Failed to render page due to memory constraints. Try reducing image count or quality.")}}},Q=Object.freeze(Object.defineProperty({__proto__:null,default:({images:r,setImages:a,onReset:s,onBack:o})=>{const[n,i]=t.useState({}),[l,h]=t.useState(!1),[m,x]=t.useState("a4"),[g,p]=t.useState({width:100,height:150}),[b,v]=t.useState("portrait"),[f,w]=t.useState({top:10,right:10,bottom:10,left:10}),[j,y]=t.useState(!1),[N,k]=t.useState(!1),[S,C]=t.useState(!1),[M,P]=t.useState(1),[L,E]=t.useState(1),_=r.length>0?r[0].size:null,R="Random Size"===_?.name,I=t.useMemo(()=>"a4"===m?D:g,[m,g]),z=t.useMemo(()=>"landscape"===b?{width:I.height,height:I.width}:I,[I,b]),F=t.useMemo(()=>U(z.width,z.height,_,f,l,j),[z,_,f,l,j]).max,W=Object.values(n).reduce((e,t)=>e+t,0),O=t.useMemo(()=>{if(R)return r;const e=[],t=Object.keys(n).sort((e,t)=>r.findIndex(t=>t.id===e)-r.findIndex(e=>e.id===t));for(const a of t){const t=r.find(e=>e.id===a);if(t)for(let r=0;r<(n[a]||0);r++)e.push(t)}return e},[n,r,R]),T=t.useMemo(()=>{if(0===O.length)return[];const e=B(z.width-f.left-f.right),t=B(z.height-f.top-f.bottom);if(e<=0||t<=0)return[];const r=B(j?0:2),a=[[]];let s=0;if(R){const o=B(45),n=Math.min(o,t)*L;let i={x:0,y:0},l=0;for(const d of O){let o=n*(d.width_px/d.height_px),c=n;90===d.rotation&&([o,c]=[c,o]),i.x>0&&i.x+o>e&&(i.x=0,i.y+=l+r,l=0),i.y+c>t&&(a.push([]),s++,i={x:0,y:0},l=0),a[s].push({...d,x:i.x,y:i.y,renderWidth:o,renderHeight:c}),i.x+=o+r,l=Math.max(l,c)}}else{const o=B(l&&!j?2:0),n=S?_.height_mm:_.width_mm,i=S?_.width_mm:_.height_mm,d=B(n)+2*o,c=B(i)+2*o,h=d>0?Math.floor((e+r)/(d+r)):0,m=h*(c>0?Math.floor((t+r)/(c+r)):0);if(m>0){const e=O.slice(0,m);for(let t=0;t<e.length;t++){const o=t%m,n=o%h,i=Math.floor(o/h);a[s].push({...e[t],x:n*(d+r),y:i*(c+r),renderWidth:d,renderHeight:c})}}}return a.filter(e=>e.length>0)},[O,z,f,j,R,l,S,_,L]);t.useEffect(()=>{M>T.length&&T.length>0?P(T.length):0===T.length&&1!==M&&P(1)},[M,T.length]),t.useEffect(()=>{if(R)return;const e={};if(r.length>0&&F>0){const t=Math.floor(F/r.length);let a=F%r.length;for(const s of r)e[s.id]=t+(a-- >0?1:0)}i(e)},[r,F,R]);const A=async()=>{if(0===T.length)return null;const{jsPDF:e}=jspdf,t=new e({orientation:z.width>z.height?"l":"p",unit:"mm",format:[z.width,z.height]});for(let r=0;r<T.length;r++){r>0&&t.addPage();const e=await V({page:T[r],showCutMarks:l,paperDimensions:z,margins:f,noGap:j});t.addImage(e.toDataURL("image/png"),"PNG",0,0,z.width,z.height)}return t},$=async e=>{if(!(N||"pdf"===e&&"undefined"==typeof jspdf)){k(!0);try{if("pdf"===e){const e=await A();e&&e.save("passport-photos.pdf")}else if("png"===e&&T[M-1]){const e=await V({page:T[M-1],showCutMarks:l,paperDimensions:z,margins:f,noGap:j}),t=document.createElement("a");t.href=e.toDataURL("image/png"),t.download=`passport-photos_page_${M}.png`,t.click(),t.remove();const r=e.getContext("2d");r&&r.clearRect(0,0,e.width,e.height)}}catch(t){alert("Export failed due to memory constraints. Try with fewer images or lower quality settings.")}finally{k(!1)}}};if(!_)return e.jsxs("div",{className:"text-center p-8 bg-[var(--card-bg)] backdrop-blur-sm border border-[var(--card-border)] rounded-2xl",children:[e.jsx("h2",{className:"text-xl",children:"No images to print."}),e.jsx("button",{onClick:o,className:"mt-4 bg-[var(--accent-primary)] px-4 py-2 rounded-lg text-white",children:"Add Photos"})]});const H=T[M-1]||[];return e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 items-start safe-bottom",children:[e.jsxs("div",{className:"flex-1 w-full bg-[var(--card-bg)] backdrop-blur-sm border border-[var(--card-border)] rounded-2xl shadow-lg shadow-[var(--shadow-color)] flex flex-col",children:[e.jsx("h2",{className:"text-xl font-bold p-4 sm:p-6 border-b border-[var(--card-border)] text-[var(--text-primary)]",children:"Print Preview"}),e.jsx("div",{className:"bg-slate-200/50 dark:bg-slate-900/60 p-4 sm:p-6 rounded-b-2xl flex-grow flex justify-center items-center min-h-[50vh] lg:min-h-0",children:e.jsx(q,{page:H,showCutMarks:l,paperDimensions:z,margins:f,noGap:j})}),R&&T.length>1&&e.jsxs("div",{className:"flex justify-center items-center p-3 gap-4 border-t border-[var(--card-border)]",children:[e.jsx("button",{onClick:()=>P(e=>Math.max(1,e-1)),disabled:1===M,className:"px-4 py-2 bg-[var(--control-bg)] rounded-md disabled:opacity-50 transition-colors hover:bg-[var(--control-bg)]/80",children:"Prev"}),e.jsxs("span",{className:"font-semibold text-[var(--text-secondary)]",children:["Page ",M," of ",T.length]}),e.jsx("button",{onClick:()=>P(e=>Math.min(T.length,e+1)),disabled:M===T.length,className:"px-4 py-2 bg-[var(--control-bg)] rounded-md disabled:opacity-50 transition-colors hover:bg-[var(--control-bg)]/80",children:"Next"})]})]}),e.jsxs("div",{className:"w-full lg:w-96 flex-shrink-0 flex flex-col gap-y-6",children:[e.jsxs("div",{className:"bg-[var(--card-bg)] backdrop-blur-sm border border-[var(--card-border)] rounded-2xl shadow-lg shadow-[var(--shadow-color)] p-6 flex flex-col",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-[var(--text-primary)]",children:"Actions"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:async()=>{if(!N&&"undefined"!=typeof jspdf){k(!0);try{const e=await A();if(!e)return;e.autoPrint();const t=e.output("blob");window.open(URL.createObjectURL(t),"_blank")}catch(e){alert("Error preparing file for printing.")}finally{k(!1)}}},disabled:N||0===O.length,className:"w-full flex items-center justify-center bg-[var(--accent-primary)] hover:opacity-90 text-white font-bold py-3 px-4 rounded-lg transition-all duration-300 active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(d,{className:"w-5 h-5 mr-2"}),N?"Processing...":"Print / Save as PDF"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>$("pdf"),disabled:N||0===O.length,className:"flex-1 flex items-center justify-center bg-[var(--accent-secondary)] hover:opacity-90 text-white font-bold py-2 sm:py-2 px-2 sm:px-4 rounded-lg transition-colors duration-300 disabled:opacity-50 disabled:cursor-not-allowed min-h-touch touch-target",children:[e.jsx("span",{className:"hidden sm:inline",children:"Export "}),"PDF"]}),e.jsxs("button",{onClick:()=>$("png"),disabled:N||0===O.length,className:"flex-1 flex items-center justify-center bg-[var(--accent-secondary)] hover:opacity-90 text-white font-bold py-2 sm:py-2 px-2 sm:px-4 rounded-lg transition-colors duration-300 disabled:opacity-50 disabled:cursor-not-allowed min-h-touch touch-target",children:["Export ",e.jsx("span",{className:"hidden sm:inline",children:" "}),"PNG"]})]}),e.jsxs("button",{onClick:o,className:"w-full flex items-center justify-center pt-2 text-sm text-[var(--text-secondary)] hover:text-[var(--accent-primary)] font-semibold transition-colors",children:[e.jsx(c,{className:"w-4 h-4 mr-1.5"}),"Back to Edit"]}),e.jsx("button",{onClick:s,className:"w-full text-center text-sm text-[var(--text-secondary)] hover:text-red-500",children:"Start Over"})]})]}),e.jsxs("div",{className:"bg-[var(--card-bg)] backdrop-blur-sm border border-[var(--card-border)] rounded-2xl shadow-lg shadow-[var(--shadow-color)] p-6 flex flex-col",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-[var(--text-primary)]",children:"Print Options"}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-1.5",children:"Paper Size"}),e.jsxs("select",{value:m,onChange:e=>x(e.target.value),className:"w-full bg-[var(--control-bg)] border border-[var(--control-border)] rounded-md py-2 px-3 text-[var(--text-primary)] focus:ring-[var(--accent-primary)] focus:border-[var(--accent-primary)] transition",children:[e.jsx("option",{value:"a4",children:"A4 (210 x 297 mm)"}),e.jsx("option",{value:"custom",children:"Custom"})]}),"custom"===m&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-2 p-3 bg-[var(--control-bg)]/80 rounded-md border border-[var(--control-border)]",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"custom-width",className:"block text-xs font-medium text-[var(--text-secondary)] mb-1",children:"Width (mm)"}),e.jsx("input",{type:"number",id:"custom-width",value:g.width,onChange:e=>p(t=>({...t,width:Number(e.target.value)})),min:"1",className:"w-full bg-[var(--background-start-rgb)] border border-[var(--control-border)] rounded-md py-1 px-2 text-sm text-[var(--text-primary)] focus:ring-[var(--accent-primary)] focus:border-[var(--accent-primary)]"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"custom-height",className:"block text-xs font-medium text-[var(--text-secondary)] mb-1",children:"Height (mm)"}),e.jsx("input",{type:"number",id:"custom-height",value:g.height,onChange:e=>p(t=>({...t,height:Number(e.target.value)})),min:"1",className:"w-full bg-[var(--background-start-rgb)] border border-[var(--control-border)] rounded-md py-1 px-2 text-sm text-[var(--text-primary)] focus:ring-[var(--accent-primary)] focus:border-[var(--accent-primary)]"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-1.5",children:"Paper Orientation"}),e.jsxs("div",{className:"flex w-full bg-[var(--control-bg)] rounded-md p-1 border border-[var(--control-border)]",children:[e.jsx("button",{onClick:()=>v("portrait"),className:"w-1/2 py-1.5 text-sm font-semibold rounded-md transition-colors "+("portrait"===b?"bg-[var(--accent-primary)] text-white":"text-[var(--text-secondary)] hover:bg-black/5"),children:"Portrait"}),e.jsx("button",{onClick:()=>v("landscape"),className:"w-1/2 py-1.5 text-sm font-semibold rounded-md transition-colors "+("landscape"===b?"bg-[var(--accent-primary)] text-white":"text-[var(--text-secondary)] hover:bg-black/5"),children:"Landscape"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-1.5",children:"Margins (mm)"}),e.jsx("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2",children:Object.keys(f).map(t=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:`margin-${String(t)}`,className:"block text-xs font-medium text-[var(--text-tertiary)] mb-1 capitalize",children:String(t)}),e.jsx("input",{type:"number",id:`margin-${String(t)}`,value:f[t],onChange:e=>((e,t)=>{const r=Number(t);r>=0&&w(t=>({...t,[e]:r}))})(t,e.target.value),min:"0",className:"w-full bg-[var(--background-start-rgb)] border border-[var(--control-border)] rounded-md py-1 px-2 text-sm text-[var(--text-primary)] focus:ring-[var(--accent-primary)] focus:border-[var(--accent-primary)]"})]},t))})]}),e.jsxs("div",{className:"space-y-3 pt-2",children:[!R&&e.jsxs("div",{className:"flex items-center justify-between bg-[var(--control-bg)]/80 p-3 rounded-lg",children:[e.jsx("label",{htmlFor:"cut-marks-toggle",className:"text-sm font-medium text-[var(--text-secondary)]",children:"Show Cut Marks"}),e.jsx("button",{id:"cut-marks-toggle",role:"switch","aria-checked":l,onClick:()=>h(e=>!e),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(l?"bg-[var(--accent-primary)]":"bg-[var(--control-border)]"),children:e.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(l?"translate-x-6":"translate-x-1")})})]}),e.jsxs("div",{className:"flex items-center justify-between bg-[var(--control-bg)]/80 p-3 rounded-lg",children:[e.jsx("label",{htmlFor:"no-gap-toggle",className:"text-sm font-medium text-[var(--text-secondary)]",children:"No Gap Between Photos"}),e.jsx("button",{id:"no-gap-toggle",role:"switch","aria-checked":j,onClick:()=>y(e=>!e),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(j?"bg-[var(--accent-primary)]":"bg-[var(--control-border)]"),children:e.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(j?"translate-x-6":"translate-x-1")})})]})]}),!R&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold text-[var(--text-primary)] mt-2 mb-2",children:"Photo Quantities"}),e.jsxs("div",{className:"text-center bg-[var(--control-bg)]/80 p-2 rounded-md mb-3 border border-[var(--control-border)]",children:[e.jsxs("span",{className:"text-[var(--text-secondary)] text-sm",children:["Total on sheet:"," "]}),e.jsxs("span",{className:"font-semibold text-[var(--text-primary)]",children:[W," / ",Number(F)]}),e.jsx("div",{className:"mt-1 h-1.5 w-full bg-[var(--control-border)] rounded-full",children:e.jsx("div",{className:"bg-[var(--accent-primary)] h-1.5 rounded-full",style:{width:(Number(F)>0?W/Number(F)*100:0)+"%"}})})]}),e.jsx("div",{className:"space-y-4 max-h-60 overflow-y-auto pr-2 -mr-2",children:r.map(t=>{const r=n[t.id]||0;return e.jsxs("div",{className:"bg-[var(--control-bg)]/80 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("img",{src:t.dataUrl,className:"w-12 h-12 rounded object-cover",alt:"thumbnail"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg font-bold text-[var(--accent-primary)] w-8 text-center",children:r}),e.jsx("button",{onClick:()=>{return e=t.id,void a(t=>t.map(t=>t.id===e?{...t,rotation:90===t.rotation?0:90}:t));var e},title:"Rotate 90°",className:"p-2 bg-[var(--control-bg)] hover:bg-[var(--control-border)] rounded-md transition-colors text-[var(--text-secondary)]",children:e.jsx(u,{className:"w-4 h-4"})})]})]}),e.jsx("label",{htmlFor:`quantity-${t.id}`,className:"sr-only",children:"Quantity for image"}),e.jsx("input",{id:`quantity-${t.id}`,type:"range",min:"0",max:Number(F)>0?(n[t.id]||0)+(Number(F)-W):0,value:r,onChange:e=>((e,t)=>{if(R)return void i({...n,[e]:t});const r=Object.entries(n).filter(([t])=>t!==e).reduce((e,[,t])=>e+t,0),a=F-r,s=Math.min(t,a);s>=0&&i({...n,[e]:s})})(t.id,Number(e.target.value)),className:"w-full h-2 mt-2 bg-black/10 rounded-lg appearance-none cursor-pointer accent-[var(--accent-primary)]",disabled:0===Number(F),"aria-label":`Quantity for image ${t.id}`})]},t.id)})}),e.jsx("button",{onClick:()=>{if(0===r.length||!_||R)return;const e="a4"===m?D:g,t=U(e.width,e.height,_,f,l,j),a=U(e.height,e.width,_,f,l,j),s=a.max>t.max?a.max:t.max;if(v(a.max>t.max?"landscape":"portrait"),C(a.max>t.max?a.rotateForMax:t.rotateForMax),s<=0)return void i(r.reduce((e,t)=>({...e,[t.id]:0}),{}));const o={},n=Math.floor(s/r.length);let d=s%r.length;r.forEach(e=>{o[e.id]=n+(d-- >0?1:0)}),i(o)},className:"w-full mt-4 bg-[var(--control-bg)] hover:bg-[var(--control-border)] text-[var(--text-secondary)] font-bold py-2 px-4 rounded-lg transition-colors duration-200 active:scale-[0.98]",children:"Optimize & Fill Page"})]}),R&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold text-[var(--text-primary)] mt-2 mb-2",children:"Image Layout"}),e.jsx("div",{className:"space-y-4 bg-[var(--control-bg)]/80 p-3 rounded-lg",children:e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"scale-slider",className:"flex justify-between text-sm font-medium text-[var(--text-secondary)] mb-1.5",children:[e.jsx("span",{children:"Scale Images"}),e.jsxs("span",{className:"font-bold text-[var(--accent-primary)]",children:[Math.round(100*L),"%"]})]}),e.jsx("input",{id:"scale-slider",type:"range",min:"0.1",max:"2",step:"0.05",value:L,onChange:e=>E(Number(e.target.value)),className:"w-full h-2 bg-black/10 dark:bg-black/20 rounded-lg appearance-none cursor-pointer accent-[var(--accent-primary)]","aria-label":"Scale images for layout"})]})}),e.jsx("div",{className:"text-center bg-[var(--control-bg)]/80 p-3 rounded-md mt-4 border border-[var(--control-border)]",children:e.jsxs("p",{className:"font-semibold text-[var(--text-primary)] mt-1",children:[O.length," images placed on"," ",T.length," sheet(s)."]})})]})]})]})]})]})}},Symbol.toStringTag,{value:"Module"}));export{l as C,W as E,C as I,g as M,z as O,d as P,x as S,i as U,v as X,S as a,M as b,P as c,L as d,$ as e,Q as f,F as u};
